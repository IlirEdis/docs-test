import { RemoteContent } from "nextra/data";
import { buildDynamicMDX, buildDynamicMeta } from "nextra/remote";

export const getStaticProps = async ({ params }) => {

const {addDocsSlug} = params;

console.log("SLUGG", addDocsSlug);

const res = await fetch(
`https://glorious-snazzy-hot.strapiapp.com/api/doc-articles?populate[AdditionalDocs][populate]=*&filters[Slug][$eq][0]=${addDocsSlug[0]}&filters[AdditionalDocs][Slug][$eq][1]=${addDocsSlug[1]}&pagination[start]=0&pagination[limit]=50`
);

// `https://glorious-snazzy-hot.strapiapp.com/api/doc-articles?populate=*&filters[Slug][$eq][0]=${params.docsSlug[0]}&filters[Slug][$eq][1]=${params.docsSlug[1]}&pagination[start]=0&pagination[limit]=50`

const doc = await res.json();

console.log("DOC", doc);

return {
props: {
...(await buildDynamicMDX(doc.data[0].attributes.MarkdownContent, {
defaultShowCopyCode: true,
})),
...(await buildDynamicMeta()),
},
revalidate: 10,
}
};

export const getStaticPaths = async () => {

const res = await fetch(
"https://glorious-snazzy-hot.strapiapp.com/api/doc-articles?populate[0]=AdditionalDocs&pagination[start]=0&pagination[limit]=50"
);

const docs = await res.json();

// console.log("DOCSSS", docs.data[0].attributes)

// const paths = docs.data.map((path)=> (path.attributes.AdditionalDocs.length === 0 ?
// ({params:{ docsSlug: `/docs/${path.attributes.Slug}`}}) : (path.attributes.AdditionalDocs.map((subPath)=> ({params:{docsSlug:`/docs/${path.attributes.Slug}/${subPath.Slug}`}})))
// ))

// const paths = docs.data.map((path) => ({
// docsSlug:`/docs/${path.attributes.Slug}`
// }))
const paths = docs.data.map((path) => (
path.attributes.AdditionalDocs.map((subPath)=>(
`/docs/${path.attributes.Slug}/${subPath.Slug}`
))

));

const mergedPaths = paths.flat(1)

// const paths = docs.data.map((path) =>
// (path.attributes.AdditionalDocs === 0 ? `/docs/${path.attributes.Slug}` : path.attributes.AdditionalDocs.map((subPath)=> `/docs/${path.attributes.Slug}/${subPath.Slug}`) ))

// console.log("PATHSSS", mergedPaths)

// return {
// paths: docs.data.map((doc) => ({
// params: { docsSlug: doc.attributes.Slug },
// })),
// fallback: "blocking",
// };
// };
return {
paths: mergedPaths,
fallback: false,
};
};

<RemoteContent />

{/* "https://glorious-snazzy-hot.strapiapp.com/api/docs?populate[MarkdownContent]?pagination[start]=0&pagination[limit]=50" */}
{/* https://glorious-snazzy-hot.strapiapp.com/api/server-locations?populate[lookingGlassOptions][populate]=*&populate[dynamic][populate]=speedTest&sort[0]=Country&sort[1]=City?pagination[start]=0&pagination[limit]=50 */}
